<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FPL Slot Machine â€” Pro (DataFPL)</title>
<style>
  :root{ --bg1:#123524;--bg2:#0a7e6e;--accent:#00ff88;--danger:#ff4444; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Trebuchet MS',sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#fff;margin:0;display:flex;flex-direction:column;align-items:center;}
  h1{margin:18px 12px 4px;font-size:clamp(1.6rem,3.5vw,2.6rem);text-shadow:2px 2px #000}
  .sub{opacity:.85;margin-bottom:8px;font-size:.95rem}
  .wrap{width:min(960px,100%);padding:0 12px 16px}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
  .control-card{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:10px}
  .control-card h3{margin:0 0 8px;font-size:1rem;opacity:.9}
  .input-container{display:grid;grid-template-columns:repeat(3,minmax(120px,1fr));gap:8px}
  .input-container input{padding:10px;font-size:16px;border-radius:10px;border:none;text-align:center;outline:none}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  select,.stat{padding:10px;border-radius:10px;border:none;font-size:15px;background:#ffffff;color:#111;font-weight:600;min-width:160px}
  .stat{background:#0d2e25;color:#eafcf3;border:1px solid rgba(255,255,255,.12)}
  .reels{display:flex;justify-content:center;margin:22px 0 10px;gap:16px;width:100%}
  .reel{width:clamp(96px,18vw,140px);height:clamp(96px,18vw,140px);background:#fff;color:#000;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:clamp(18px,3.2vw,26px);font-weight:800;box-shadow:2px 2px 2px #0003;}
  .btns{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:8px 0 0}
  button{padding:12px 18px;font-size:17px;border:none;border-radius:10px;cursor:pointer;font-weight:800}
  #spinBtn{background:var(--accent);color:#000}
  #resetBtn{background:var(--danger);color:#fff;display:none}
  #muteBtn{background:#222;color:#fff}
  #saveBtn{background:#0b0b0b;color:#fff;border:1px solid rgba(255,255,255,.18)}
  #result{margin:10px 12px 8px;font-size:clamp(20px,3.6vw,30px);font-weight:900;min-height:40px;text-shadow:2px 2px #000;word-break:break-word;text-align:center}
  #history{font-size:.95rem;opacity:.95;display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
  .chip{background:#083228;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.12)}
  canvas{position:fixed;inset:0;pointer-events:none;z-index:9999}
  footer{margin-top:auto;opacity:.75;padding:8px 0 14px;font-size:.85rem}
</style>
<!-- Preload audio for smooth experience -->
<link rel="preload" href="sounds/spin.mp3" as="audio">
<link rel="preload" href="sounds/tick.mp3" as="audio">
<link rel="preload" href="sounds/jackpot.mp3" as="audio">
</head>
<body>
  <h1>ðŸŽ° FPL Slot Machine â€” Pro (DataFPL)</h1>
  <div class="sub">Weighted jackpot: starts <b>20%</b>, +<b>10%</b> each miss, resets to 20% on hit (Just for fun).</div>

  <div class="wrap">
    <div class="controls">
      <div class="control-card">
        <h3>Players</h3>
        <div class="input-container" id="inputs">
          <input id="side1" value="Salah">
          <input id="side2" value="Haaland">
          <input id="side3" value="Ekitike">
          <input id="side4" value="Saka">
          <input id="side5" value="Bruno">
          <input id="side6" value="Palmer">
        </div>
        <div style="opacity:.7;font-size:.9rem;margin-top:6px">Tip: press Enter to save names. Your setup persists automatically.</div>
      </div>

      <div class="control-card">
        <h3>Theme & Stats</h3>
        <div class="row">
          <select id="themeSelect" title="Theme">
            <option value="Default FPL">Default (Green)</option>
            <option value="Arsenal">Arsenal</option>
            <option value="Liverpool">Liverpool</option>
            <option value="ManCity">Man City</option>
            <option value="Spurs">Spurs</option>
            <option value="Chelsea">Chelsea</option>
            <option value="ManUnited">Man United</option>
          </select>
          <div class="stat" id="statSpins">Spins: 0</div>
          <div class="stat" id="statJackpots">Jackpots: 0</div>
          <div class="stat" id="statRate">Rate: 0%</div>
          <div class="stat" id="statChance">Chance: 20%</div>
        </div>
      </div>
    </div>

    <div class="reels">
      <div class="reel" id="reel1">?</div>
      <div class="reel" id="reel2">?</div>
      <div class="reel" id="reel3">?</div>
    </div>

    <div class="btns">
      <button id="spinBtn">SPIN!</button>
      <button id="resetBtn">Play Again</button>
      <button id="muteBtn" aria-pressed="false">ðŸ”Š Sound On</button>
      <button id="saveBtn" title="Save current result as an image">ðŸ’¾ Save Result</button>
    </div>

    <div id="result" role="status" aria-live="polite"></div>
    <div id="history"></div>
  </div>

  <canvas id="confetti"></canvas>

<script>
(() => {
  const LS_KEY = "fplslot_pro_random_v1";
  const themes = {
    Default:{bg1:"#123524", bg2:"#0a7e6e", accent:"#00ff88"},
    Arsenal:{bg1:"#8a0303", bg2:"#ff4d4d", accent:"#ffd700"},
    Liverpool:{bg1:"#006341", bg2:"#d00027", accent:"#ffd700"},
    ManCity:{bg1:"#6ca6d9", bg2:"#1b4f72", accent:"#f5f5f5"},
    Spurs:{bg1:"#0c2340", bg2:"#1f4b99", accent:"#f0eaea"},
    Chelsea:{bg1:"#001489", bg2:"#0d3685", accent:"#ffd700"},
    ManUnited:{bg1:"#da291c", bg2:"#111111", accent:"#ffd100"},
  };

  let state = {
    spinCount: 0, jackpots: 0,
    names: ["Salah","Haaland","Ekitike","Saka","Bruno","Palmer"],
    theme: "Default", history: [],
    jackpotChance: 0.2 // start 20%
  };

  const reels = [document.getElementById("reel1"), document.getElementById("reel2"), document.getElementById("reel3")];
  const inputs = [...document.querySelectorAll("#inputs input")];
  const themeSelect = document.getElementById("themeSelect");
  const statSpins = document.getElementById("statSpins");
  const statJackpots = document.getElementById("statJackpots");
  const statRate = document.getElementById("statRate");
  const statChance = document.getElementById("statChance");
  const resultDiv = document.getElementById("result");
  const historyDiv = document.getElementById("history");
  const spinBtn = document.getElementById("spinBtn");
  const resetBtn = document.getElementById("resetBtn");
  const muteBtn = document.getElementById("muteBtn");
  const saveBtn = document.getElementById("saveBtn");

  // --- AUDIO SETUP ---
  // Make sure to include the audio files in the public 'sounds/' directory
  const spinMusic = new Audio('sounds/spin.mp3');
  const tickSound = new Audio('sounds/tick.mp3');
  const jackpotSound = new Audio('sounds/jackpot.mp3');
  spinMusic.volume = 0.6;
  tickSound.volume = 0.3;
  jackpotSound.volume = 0.8;

  let spinning = false, muted = false;
  function setMuted(on){
    muted = on;
    [spinMusic, tickSound, jackpotSound].forEach(a => a.muted = on);
    muteBtn.textContent = muted ? "ðŸ”‡ Sound Off" : "ðŸ”Š Sound On";
    muteBtn.setAttribute("aria-pressed", muted ? "true" : "false");
  }
  muteBtn.addEventListener("click", () => setMuted(!muted));

  function applyTheme(name){
    const th = themes[name] || themes.Default;
    document.documentElement.style.setProperty("--bg1", th.bg1);
    document.documentElement.style.setProperty("--bg2", th.bg2);
    document.documentElement.style.setProperty("--accent", th.accent);
    state.theme = name; saveState();
  }
  themeSelect.addEventListener("change", e => applyTheme(e.target.value));

  function loadState(){ try{ const raw=localStorage.getItem(LS_KEY); if(raw){ Object.assign(state, JSON.parse(raw)); } }catch(e){} }
  function saveState(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(state)); }catch(e){} }

  function populateInputs(){ inputs.forEach((el,i)=> el.value = state.names[i] || ""); }
  function getFaces(){ const arr = inputs.map(i=>(i.value||"").trim()).filter(Boolean); return arr.length?arr:["?","?","?","?","?","?"]; }
  function saveNames(){ state.names = inputs.map(i=>(i.value||"").trim()); saveState(); }
  inputs.forEach(i=>{ i.addEventListener("change", saveNames); i.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); saveNames(); i.blur(); }}); });

  function refreshStats(){
    statSpins.textContent = "Spins: " + state.spinCount;
    statJackpots.textContent = "Jackpots: " + state.jackpots;
    const rate = state.spinCount ? ((state.jackpots/state.spinCount)*100).toFixed(1) : "0.0";
    statRate.textContent = "Rate: " + rate + "%";
    statChance.textContent = "Chance: " + Math.round((state.jackpotChance||0.2)*100) + "%";
    historyDiv.innerHTML = "";
    state.history.slice(-8).reverse().forEach(h=>{
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.textContent = h.text;
      historyDiv.appendChild(chip);
    });
  }

  const canvas = document.getElementById("confetti");
  const ctx = canvas.getContext("2d");
  function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resizeCanvas(); window.addEventListener("resize", resizeCanvas);

  function makeConfetti() {
    resizeCanvas();
    const particles = [];
    for (let i=0;i<200;i++){
      particles.push({ x:Math.random()*canvas.width, y:-20-Math.random()*canvas.height, r:Math.random()*4+2, color:`hsl(${Math.random()*360},100%,50%)`, vy:2+Math.random()*2, vx:-1+Math.random()*2 });
    }
    const start = performance.now();
    function draw(now){
      const elapsed = now - start;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      particles.forEach(p=>{
        p.x += p.vx; p.y += p.vy;
        ctx.beginPath(); ctx.fillStyle=p.color; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      });
      if (elapsed < 4000) requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);
  }
  function makeFirework(){
    resizeCanvas();
    const x = Math.random()*canvas.width, y = Math.random()*canvas.height/2;
    const ps = [];
    for(let i=0;i<60;i++){
      const a = (i/60)*Math.PI*2, s = 1+Math.random()*5.5;
      ps.push({ x,y, r:2, dx:Math.cos(a)*s, dy:Math.sin(a)*s, color:`hsl(${Math.random()*360},100%,50%)` });
    }
    const start = performance.now();
    function anim(now){
      const t = now - start;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ps.forEach(p=>{ p.x+=p.dx; p.y+=p.dy; p.r*=0.97; ctx.beginPath(); ctx.arc(p.x,p.y,Math.max(0.2,p.r),0,Math.PI*2); ctx.fillStyle=p.color; ctx.fill(); });
      if (t<900) requestAnimationFrame(anim);
    }
    requestAnimationFrame(anim);
  }

  function spin(){
    if (spinning) return;
    spinning = true;
    state.spinCount++; saveState(); refreshStats();

    const faces = getFaces();
    const roll = Math.random();
    const isJackpot = roll < (state.jackpotChance ?? 0.2);
    if (isJackpot) state.jackpotChance = 0.2;
    else state.jackpotChance = Math.min((state.jackpotChance ?? 0.2)+0.1, 1.0);
    saveState(); refreshStats();

    const jackpotSymbol = faces[Math.floor(Math.random() * faces.length)];
    const durations = [1700, 2500, 3300];

    const start = performance.now();
    const starts = [start,start,start];
    const done = [false,false,false];

    // Play spin sound!
    if (!muted) { spinMusic.currentTime = 0; spinMusic.play(); }

    function updateReel(i, now){
      const elapsed = now - starts[i];
      if (elapsed < durations[i]){
        const rand = Math.floor(Math.random()*faces.length);
        reels[i].textContent = faces[rand];
        // Play tick sound on reel "tick"
        if (!muted && elapsed - (reels[i]._lastTick||0) > 110){ 
          tickSound.currentTime = 0; 
          tickSound.play(); 
          reels[i]._lastTick = elapsed; 
        }
      } else if (!done[i]){
        reels[i].textContent = isJackpot ? jackpotSymbol : faces[Math.floor(Math.random()*faces.length)];
        done[i] = true;
      }
    }
    function loop(now){
      updateReel(0,now); updateReel(1,now); updateReel(2,now);
      if (done[0] && done[1] && done[2]) endSpin(isJackpot, jackpotSymbol);
      else requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    spinBtn.disabled = true;
    resetBtn.style.display = "none";
  }

  function endSpin(isJackpot, symbol){
    let text;
    if (isJackpot){
      state.jackpots++; saveState(); refreshStats();
      text = "ðŸŽ‰ YOUR CAPTAIN IS ... " + symbol + " ðŸŽ‰";
      makeConfetti(); for(let i=0;i<4;i++) setTimeout(makeFirework, i*1600);
      if (!muted) { jackpotSound.currentTime = 0; jackpotSound.play(); }
    } else {
      const vals = reels.map(r=>r.textContent);
      text = vals.join(" | ");
    }
    resultDiv.textContent = text;
    state.history.push({ ts: Date.now(), text }); if (state.history.length>24) state.history.shift();
    saveState(); refreshStats();

    spinBtn.disabled = false;
    resetBtn.style.display = "inline-block";
    spinning = false;
  }

  function resetGame(){
    resultDiv.textContent = "";
    reels.forEach(r=> r.textContent = "?");
    resetBtn.style.display = "none";
  }

  // dummy save image removed for brevity
  function saveImage(){ alert("Use the GitHub pack if you want image export."); }

  spinBtn.addEventListener("click", spin);
  resetBtn.addEventListener("click", resetGame);
  saveBtn.addEventListener("click", saveImage);

  // Init
  loadState();
  if (typeof state.jackpotChance !== "number" || isNaN(state.jackpotChance)) state.jackpotChance = 0.2;
  populateInputs();
  themeSelect.value = state.theme || "Default";
  applyTheme(themeSelect.value);
  refreshStats();
  setMuted(false); // sound on by default
})();
</script>
<footer>Made with SLLVP who is accountant not DeveloperðŸ’š</footer>
</body>
</html>
